copy the stuff from iobserve collector and adapt
